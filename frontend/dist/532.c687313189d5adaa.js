"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[532],{9532:(O,g,r)=>{r.d(g,{UsersListComponent:()=>w});var _=r(1413),f=r(3236),b=r(9974),F=r(4360),m=r(9769),c=r(4341),k=r(3794),C=r(3413),e=r(5547),l=r(375),j=r(7705),E=r(4666),R=r(9864);const T=()=>[];function U(s,o){if(1&s&&(e.j41(0,"option",20),e.EFF(1),e.k0s()),2&s){const t=o.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function D(s,o){if(1&s&&(e.j41(0,"option",21),e.EFF(1),e.k0s()),2&s){const t=o.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function L(s,o){1&s&&(e.j41(0,"div"),e.EFF(1,"Chargement..."),e.k0s())}function $(s,o){if(1&s&&(e.j41(0,"div",22),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.error)}}function x(s,o){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td",25)(14,"div",26)(15,"button",27),e.bIt("click",function(){const n=l.eBV(t).$implicit,a=e.XpG(2);return l.Njj(a.onEditUser(n))}),e.j41(16,"span",28),e.EFF(17,"\u270f\ufe0f"),e.k0s()(),e.j41(18,"button",29),e.bIt("click",function(){const n=l.eBV(t).$implicit,a=e.XpG(2);return l.Njj(a.onDeleteUser(n))}),e.j41(19,"span",22),e.EFF(20,"\u{1f5d1}\ufe0f"),e.k0s()()()()()}if(2&s){const t=o.$implicit,i=o.index,n=e.XpG(2);e.R7$(2),e.JRh((n.page-1)*n.limit+i+1),e.R7$(2),e.JRh(t.username),e.R7$(2),e.JRh(t.nom),e.R7$(2),e.JRh(t.prenom),e.R7$(2),e.JRh(t.email),e.R7$(2),e.JRh(t.role)}}function G(s,o){if(1&s&&(e.j41(0,"table",23)(1,"thead")(2,"tr")(3,"th"),e.EFF(4,"#"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Username"),e.k0s(),e.j41(7,"th"),e.EFF(8,"Nom"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Pr\xe9nom"),e.k0s(),e.j41(11,"th"),e.EFF(12,"Email"),e.k0s(),e.j41(13,"th"),e.EFF(14,"R\xf4le"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Action"),e.k0s()()(),e.j41(17,"tbody"),e.DNE(18,x,21,6,"tr",24),e.k0s()()),2&s){const t=e.XpG();e.R7$(18),e.Y8G("ngForOf",t.users)}}function I(s,o){1&s&&(e.j41(0,"div"),e.EFF(1,"Aucun utilisateur trouv\xe9."),e.k0s())}function M(s,o){if(1&s){const t=e.RV6();e.j41(0,"li",32)(1,"button",33),e.bIt("click",function(){const n=l.eBV(t).index,a=e.XpG(2);return l.Njj(a.goToPage(n+1))}),e.EFF(2),e.k0s()()}if(2&s){const t=o.index,i=e.XpG(2);e.AVh("active",i.page===t+1),e.R7$(2),e.JRh(t+1)}}function y(s,o){if(1&s){const t=e.RV6();e.j41(0,"nav",30)(1,"ul",31)(2,"li",32)(3,"button",33),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.goToPage(n.page-1))}),e.EFF(4,"Pr\xe9c\xe9dent"),e.k0s()(),e.DNE(5,M,3,3,"li",34),e.j41(6,"li",32)(7,"button",33),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.goToPage(n.page+1))}),e.EFF(8,"Suivant"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(2),e.AVh("disabled",1===t.page),e.R7$(3),e.Y8G("ngForOf",e.lJ4(5,T).constructor(t.totalPages)),e.R7$(),e.AVh("disabled",t.page===t.totalPages)}}function N(s,o){if(1&s&&(e.j41(0,"p"),e.EFF(1," \xcates-vous s\xfbr de vouloir supprimer l'utilisateur "),e.j41(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4),e.k0s()),2&s){const t=e.XpG(2);e.R7$(3),e.Lme("",t.userToDelete.prenom," ",t.userToDelete.nom),e.R7$(),e.SpI(" (",t.userToDelete.email,") ? ")}}function V(s,o){1&s&&e.nrm(0,"span",48)}function Y(s,o){if(1&s){const t=e.RV6();e.j41(0,"div",35)(1,"div",36)(2,"div",37)(3,"div",38)(4,"h5",39),e.EFF(5,"Confirmer la suppression"),e.k0s(),e.j41(6,"button",40),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.cancelDelete())}),e.k0s()(),e.j41(7,"div",41),e.DNE(8,N,5,3,"p",14),e.j41(9,"p",42),e.nrm(10,"i",43),e.EFF(11," Cette action est irr\xe9versible. "),e.k0s()(),e.j41(12,"div",44)(13,"button",45),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.cancelDelete())}),e.EFF(14," Annuler "),e.k0s(),e.j41(15,"button",46),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.confirmDelete())}),e.DNE(16,V,1,0,"span",47),e.EFF(17),e.k0s()()()()()}if(2&s){const t=e.XpG();e.xc7("display",t.showDeleteModal?"block":"none"),e.AVh("show",t.showDeleteModal),e.R7$(8),e.Y8G("ngIf",t.userToDelete),e.R7$(5),e.Y8G("disabled",t.deleteLoading),e.R7$(2),e.Y8G("disabled",t.deleteLoading),e.R7$(),e.Y8G("ngIf",t.deleteLoading),e.R7$(),e.SpI(" ",t.deleteLoading?"Suppression...":"Supprimer"," ")}}function X(s,o){if(1&s&&e.nrm(0,"div",49),2&s){const t=e.XpG();e.xc7("display",t.showDeleteModal?"block":"none")}}let w=(()=>{class s{constructor(t,i,n){this.userService=t,this.cdr=i,this.router=n,this.users=[],this.loading=!1,this.error=null,this.showDeleteModal=!1,this.userToDelete=null,this.deleteLoading=!1,this.page=1,this.limit=10,this.limits=[5,10,20],this.total=0,this.role="ALL",this.roles=[{label:"Tous",value:"ALL"},{label:"Admin",value:"ADMIN"},{label:"Boutique",value:"BOUTIQUE"},{label:"Client",value:"CLIENT"}],this.filterChanged$=new _.B,this.filterChanged$.pipe(function v(s,o=f.E){return(0,b.N)((t,i)=>{let n=null,a=null,d=null;const p=()=>{if(n){n.unsubscribe(),n=null;const u=a;a=null,i.next(u)}};function P(){const u=d+s,h=o.now();if(h<u)return n=this.schedule(void 0,u-h),void i.add(n);p()}t.subscribe((0,F._)(i,u=>{a=u,d=o.now(),n||(n=o.schedule(P,s),i.add(n))},()=>{p(),i.complete()},void 0,()=>{a=n=null}))})}(300)).subscribe(()=>{this.loadUsers()}),this.loadUsers()}onCreateUser(){this.router.navigate(["/admin/users/new"])}onEditUser(t){this.router.navigate(["/admin/users/edit",t._id||t.id])}onDeleteUser(t){this.userToDelete=t,this.showDeleteModal=!0,this.cdr.detectChanges()}cancelDelete(){this.showDeleteModal=!1,this.userToDelete=null,this.deleteLoading=!1,this.cdr.detectChanges()}confirmDelete(){this.userToDelete&&(this.deleteLoading=!0,this.userService.deleteUser(this.userToDelete._id||this.userToDelete.id).subscribe({next:()=>{this.loadUsers(),this.showDeleteModal=!1,this.userToDelete=null,this.deleteLoading=!1,this.cdr.detectChanges()},error:i=>{this.error=i.error?.message||"Erreur lors de la suppression",this.deleteLoading=!1,this.cdr.detectChanges(),setTimeout(()=>{this.showDeleteModal=!1,this.userToDelete=null,this.cdr.detectChanges()},3e3)}}))}loadUsers(){this.loading=!0,this.userService.getAllUsers({page:this.page,limit:this.limit,role:this.role}).subscribe({next:t=>{this.users=Array.isArray(t.users)?t.users:[],this.total="number"==typeof t.total?t.total:0,this.loading=!1,this.cdr.detectChanges()},error:t=>{this.error=t?.error?.message||"Erreur lors de la r\xe9cup\xe9ration des utilisateurs",this.users=[],this.total=0,this.loading=!1,this.cdr.detectChanges()}})}onRoleChange(t){this.role=t.target.value,this.page=1,this.filterChanged$.next()}goToPage(t){t<1||t>this.totalPages||(this.page=t,this.loadUsers())}onLimitChange(t){this.limits.includes(t)&&(this.limit=t,this.page=1,this.filterChanged$.next(),this.cdr.detectChanges())}get totalPages(){const n=Math.ceil((this.total||0)/(this.limit||1));return n>0?n:1}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(E.D),e.rXU(j.gRc),e.rXU(R.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-users-list"]],decls:25,vars:11,consts:[[1,"row"],[1,"col-sm-12"],["cardTitle","Utilisateurs"],[1,"mb-3","d-flex","align-items-center","gap-2","justify-content-between"],[1,"d-flex","align-items-center","gap-2"],["for","roleFilter",1,"form-label","mb-0"],["id","roleFilter",1,"form-select","w-auto",3,"change","value"],[3,"value",4,"ngFor","ngForOf"],["for","limitSelect",1,"form-label","mb-0","ms-3"],["id","limitSelect",1,"form-select","w-auto",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"ms-1"],[1,"btn","btn-primary",3,"click"],[1,"ti","ti-user-plus"],[4,"ngIf"],["class","text-danger",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","mt-3",4,"ngIf"],["class","modal fade show","tabindex","-1",3,"show","display",4,"ngIf"],["class","modal-backdrop fade show",3,"display",4,"ngIf"],[3,"value"],[3,"ngValue"],[1,"text-danger"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"text-center"],[1,"action-icons"],["title","Modifier",1,"btn","btn-sm","btn-icon","btn-link",3,"click"],[1,"text-primary"],["title","Supprimer",1,"btn","btn-sm","btn-icon","btn-link","text-danger",3,"click"],[1,"mt-3"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["tabindex","-1",1,"modal","fade","show"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"text-danger","mb-0"],[1,"ti","ti-alert-triangle"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"modal-backdrop","fade","show"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"div",3)(4,"div",4)(5,"label",5),e.EFF(6,"Filtrer par r\xf4le :"),e.k0s(),e.j41(7,"select",6),e.bIt("change",function(d){return n.onRoleChange(d)}),e.DNE(8,U,2,2,"option",7),e.k0s(),e.j41(9,"label",8),e.EFF(10,"Afficher :"),e.k0s(),e.j41(11,"select",9),e.bIt("ngModelChange",function(d){return n.onLimitChange(d)}),e.DNE(12,D,2,2,"option",10),e.k0s(),e.j41(13,"span",11),e.EFF(14,"par page"),e.k0s()(),e.j41(15,"button",12),e.bIt("click",function(){return n.onCreateUser()}),e.nrm(16,"i",13),e.EFF(17," Cr\xe9er un utilisateur "),e.k0s()(),e.DNE(18,L,2,0,"div",14)(19,$,2,1,"div",15)(20,G,19,1,"table",16)(21,I,2,0,"div",14)(22,y,9,6,"nav",17),e.k0s()()(),e.DNE(23,Y,18,9,"div",18)(24,X,1,2,"div",19)),2&i&&(e.R7$(7),e.Y8G("value",n.role),e.R7$(),e.Y8G("ngForOf",n.roles),e.R7$(3),e.Y8G("ngModel",n.limit),e.R7$(),e.Y8G("ngForOf",n.limits),e.R7$(6),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.error),e.R7$(),e.Y8G("ngIf",!n.loading&&n.users.length),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.users.length),e.R7$(),e.Y8G("ngIf",!n.loading&&n.totalPages>1),e.R7$(),e.Y8G("ngIf",n.showDeleteModal),e.R7$(),e.Y8G("ngIf",n.showDeleteModal))},dependencies:[m.MD,m.Sq,m.bT,k.q1,C.i,c.YN,c.xH,c.y7,c.wz,c.BC,c.vS],styles:[".table[_ngcontent-%COMP%]{margin-top:1rem}.modal[_ngcontent-%COMP%]{background-color:#00000080}.modal-content[_ngcontent-%COMP%]{border-radius:8px}.modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:1rem}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem}.text-danger[_ngcontent-%COMP%]{color:#dc3545}.spinner-border[_ngcontent-%COMP%]{width:1rem;height:1rem}"]})}}return s})()}}]);