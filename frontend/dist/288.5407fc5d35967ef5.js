"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[288],{3288:(P,g,p)=>{p.d(g,{UserFormComponent:()=>y});var c=p(3049),m=p(4341),h=p(9769),i=p(375),e=p(5547),f=p(7705),_=p(4666),u=p(9864);function C(o,l){if(1&o&&(e.j41(0,"div",45),e.nrm(1,"i",46),e.EFF(2),e.k0s()),2&o){const r=e.XpG();e.Y8G("ngClass",r.alertType),e.R7$(2),e.SpI(" ",r.message," ")}}function M(o,l){1&o&&(e.j41(0,"span",47),e.EFF(1,"(optionnel)"),e.k0s())}function F(o,l){1&o&&(e.j41(0,"small",48),e.nrm(1,"i",49),e.EFF(2," Laissez vide pour conserver le mot de passe actuel "),e.k0s())}function w(o,l){if(1&o&&(e.j41(0,"div",50)(1,"div",51),e.nrm(2,"span",52),e.k0s(),e.j41(3,"span",53),e.EFF(4),e.k0s()()),2&o){const r=e.XpG();e.R7$(2),e.HbH("level-"+r.passwordStrength),e.xc7("width",r.passwordStrength/4*100,"%"),e.R7$(),e.AVh("text-success",r.passwordStrength>=3)("text-warning",2===r.passwordStrength)("text-danger",r.passwordStrength<=1),e.R7$(),e.SpI(" ",r.passwordStrengthLabel," ")}}function b(o,l){if(1&o&&(e.j41(0,"li"),e.nrm(1,"i",56),e.EFF(2),e.k0s()),2&o){const r=l.$implicit;e.AVh("rule-ok",r.ok),e.R7$(),e.AVh("ti-circle-check",r.ok)("ti-circle-x",!r.ok),e.R7$(),e.SpI(" ",r.label," ")}}function E(o,l){if(1&o&&(e.j41(0,"ul",54),e.DNE(1,b,3,7,"li",55),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.passwordRules)}}function v(o,l){1&o&&(e.j41(0,"span",47),e.EFF(1,"(optionnel)"),e.k0s())}function j(o,l){1&o&&(e.j41(0,"div",61),e.nrm(1,"i",62),e.EFF(2,"Les mots de passe ne correspondent pas "),e.k0s())}function R(o,l){1&o&&(e.j41(0,"div",63),e.nrm(1,"i",64),e.EFF(2,"Correspondance parfaite "),e.k0s())}function k(o,l){1&o&&(e.j41(0,"div",65),e.nrm(1,"i",66),e.EFF(2,"Veuillez confirmer le mot de passe "),e.k0s())}function I(o,l){if(1&o&&(e.j41(0,"div",57),e.DNE(1,j,3,0,"div",58)(2,R,3,0,"div",59)(3,k,3,0,"div",60),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngIf",r.passwordConfirm&&!r.passwordsMatch),e.R7$(),e.Y8G("ngIf",r.passwordConfirm&&r.passwordsMatch),e.R7$(),e.Y8G("ngIf",r.password&&!r.passwordConfirm)}}function U(o,l){1&o&&(e.j41(0,"div",67),e.nrm(1,"i",68),e.EFF(2,"Laissez vide pour conserver l'ancien mot de passe "),e.k0s())}function T(o,l){if(1&o&&(e.j41(0,"option",69),e.EFF(1),e.k0s()),2&o){const r=l.$implicit;e.Y8G("value",r.value),e.R7$(),e.JRh(r.label)}}let y=(()=>{class o{constructor(r,n,s,a){this.userService=r,this.cdr=n,this.route=s,this.router=a,this.username="",this.nom="",this.prenom="",this.email="",this.password="",this.passwordConfirm="",this.telephone="",this.adresse="",this.ville="",this.codePostal="",this.pays="",this.role="",this.message="",this.loading=!1,this.alertType="alert-success",this.roles=[{label:"Administrateur",value:"ADMIN"},{label:"Client",value:"CLIENT"},{label:"Boutique",value:"BOUTIQUE"}],this.editMode=!1,this.userId=null,this.route.paramMap.subscribe(d=>{const t=d.get("id");t&&(this.editMode=!0,this.userId=t,this.loadUser(t))})}loadUser(r){this.loading=!0,this.password="",this.passwordConfirm="",this.userService.getUserById(r).subscribe({next:n=>{n&&(this.username=n.username||"",this.nom=n.nom||"",this.prenom=n.prenom||"",this.email=n.email||"",this.telephone=n.telephone||"",this.adresse=n.adresse||"",this.ville=n.ville||"",this.codePostal=n.codePostal||"",this.pays=n.pays||"",this.role=n.role||""),this.loading=!1,this.cdr.detectChanges()},error:n=>{this.message=n.error?.message||"Erreur lors du chargement de l'utilisateur.",this.alertType="alert-error",this.loading=!1,this.cdr.detectChanges()}})}ngAfterViewInit(){}get passwordStrength(){const r=this.password||"";let n=0;return r.length>=8&&n++,/[a-z]/.test(r)&&/[A-Z]/.test(r)&&n++,/\d/.test(r)&&n++,/[^a-zA-Z0-9]/.test(r)&&n++,Math.min(n,4)}get passwordStrengthLabel(){return["","Faible","Moyen","Bon","Fort"][this.passwordStrength]}get passwordRules(){const r=this.password||"";return[{label:"Au moins 8 caract\xe8res",ok:r.length>=8},{label:"Une majuscule et une minuscule",ok:/[a-z]/.test(r)&&/[A-Z]/.test(r)},{label:"Un chiffre",ok:/\d/.test(r)},{label:"Un caract\xe8re sp\xe9cial",ok:/[^a-zA-Z0-9]/.test(r)}]}get passwordsMatch(){return!!this.password&&this.password===this.passwordConfirm}get isPasswordStrong(){return this.passwordRules.every(r=>r.ok)}get canSubmit(){if(this.editMode){const r=!!this.username&&!!this.email&&!!this.role;return this.password?r&&this.passwordsMatch&&this.isPasswordStrong:r}return!!this.username&&!!this.nom&&!!this.prenom&&!!this.email&&!!this.password&&this.passwordsMatch&&this.isPasswordStrong}submit(r){if(this.canSubmit&&!this.loading){if(this.editMode){this.loading=!0,this.message="";const n={username:this.username,nom:this.nom,prenom:this.prenom,email:this.email,telephone:this.telephone,adresse:this.adresse,ville:this.ville,codePostal:this.codePostal,pays:this.pays,role:this.role};if(this.password){if(!this.isPasswordStrong)return this.message="Le mot de passe ne respecte pas tous les crit\xe8res de s\xe9curit\xe9",this.alertType="alert-error",this.loading=!1,void this.cdr.detectChanges();if(!this.passwordsMatch)return this.message="Les mots de passe ne correspondent pas",this.alertType="alert-error",this.loading=!1,void this.cdr.detectChanges();n.password=this.password}return void this.userService.updateUser(this.userId,n).subscribe({next:()=>{this.message="Utilisateur modifi\xe9 avec succ\xe8s.",this.alertType="alert-success",this.loading=!1,this.cdr.detectChanges(),setTimeout(()=>{this.router.navigate(["/admin/users"])},1e3)},error:s=>{this.message=s.error?.message??"Erreur lors de la modification",this.alertType="alert-error",this.loading=!1,this.cdr.detectChanges()}})}if(this.password!==this.passwordConfirm)return this.message="Les mots de passe ne correspondent pas",this.alertType="alert-error",void this.cdr.detectChanges();if(!this.isPasswordStrong)return this.message="Le mot de passe ne respecte pas tous les crit\xe8res de s\xe9curit\xe9",this.alertType="alert-error",void this.cdr.detectChanges();this.loading=!0,this.message="",this.userService.createUser({username:this.username,nom:this.nom,prenom:this.prenom,email:this.email,password:this.password,telephone:this.telephone,adresse:this.adresse,ville:this.ville,codePostal:this.codePostal,pays:this.pays,role:this.role}).subscribe({next:()=>{this.message="Utilisateur cr\xe9\xe9 avec succ\xe8s.",this.alertType="alert-success",this.loading=!1,this.cdr.detectChanges(),setTimeout(()=>{this.router.navigate(["/admin/users"])},1e3)},error:n=>{this.message=n.error?.message??"Erreur lors de la cr\xe9ation",this.alertType="alert-error",this.loading=!1,this.cdr.detectChanges()}})}}onCancel(){}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(_.D),e.rXU(f.gRc),e.rXU(u.nX),e.rXU(u.Ix))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-user-form"]],decls:76,vars:30,consts:[["form","ngForm"],[1,"auth-main"],[1,"auth-wrapper","v3"],[1,"auth-form"],[1,"auth-header"],[1,"card","my-5"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-end","mb-4"],[1,"mb-0"],["class","custom-alert",3,"ngClass",4,"ngIf"],[1,"form-group","mb-3"],["for","username",1,"form-label"],["type","text","id","username","placeholder","Nom d'utilisateur","name","username","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","nom",1,"form-label"],["type","text","id","nom","placeholder","Nom","name","nom","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","prenom",1,"form-label"],["type","text","id","prenom","placeholder","Pr\xe9nom","name","prenom","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","emailAddress",1,"form-label"],["type","email","id","emailAddress","placeholder","Adresse email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","mb-2"],["for","password",1,"form-label"],["class","text-muted fw-normal",4,"ngIf"],["type","password","id","password","name","password",1,"form-control",3,"ngModelChange","placeholder","ngModel","required"],["class","text-muted d-block mt-1",4,"ngIf"],["class","password-strength mt-2",4,"ngIf"],["class","password-rules list-unstyled mt-2 mb-0 small text-muted",4,"ngIf"],["for","passwordConfirm",1,"form-label"],["type","password","id","passwordConfirm","name","passwordConfirm",1,"form-control",3,"ngModelChange","placeholder","ngModel","required"],["class","small mt-1",4,"ngIf"],["class","small mt-1 text-muted",4,"ngIf"],["for","role",1,"form-label"],["id","role","name","role","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","telephone",1,"form-label"],["type","text","id","telephone","placeholder","T\xe9l\xe9phone","name","telephone",1,"form-control",3,"ngModelChange","ngModel"],["for","adresse",1,"form-label"],["type","text","id","adresse","placeholder","Adresse","name","adresse",1,"form-control",3,"ngModelChange","ngModel"],["for","ville",1,"form-label"],["type","text","id","ville","placeholder","Ville","name","ville",1,"form-control",3,"ngModelChange","ngModel"],["for","codePostal",1,"form-label"],["type","text","id","codePostal","placeholder","Code Postal","name","codePostal",1,"form-control",3,"ngModelChange","ngModel"],["for","pays",1,"form-label"],["type","text","id","pays","placeholder","Pays","name","pays",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary","w-100",3,"click","disabled"],[1,"custom-alert",3,"ngClass"],[1,"ti","ti-info-circle","me-2"],[1,"text-muted","fw-normal"],[1,"text-muted","d-block","mt-1"],[1,"ti","ti-info-circle"],[1,"password-strength","mt-2"],[1,"strength-bar"],[1,"strength-fill"],[1,"strength-label"],[1,"password-rules","list-unstyled","mt-2","mb-0","small","text-muted"],[3,"rule-ok",4,"ngFor","ngForOf"],[1,"ti","me-1"],[1,"small","mt-1"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],["class","text-warning",4,"ngIf"],[1,"text-danger"],[1,"ti","ti-alert-circle","me-1"],[1,"text-success"],[1,"ti","ti-circle-check","me-1"],[1,"text-warning"],[1,"ti","ti-alert-triangle","me-1"],[1,"small","mt-1","text-muted"],[1,"ti","ti-info-circle","me-1"],[3,"value"]],template:function(n,s){if(1&n){const a=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"span")(5,"b"),e.EFF(6),e.k0s()()(),e.j41(7,"div",5)(8,"div",6)(9,"form",null,0)(11,"div",7)(12,"h3",8)(13,"b"),e.EFF(14),e.k0s()()(),e.DNE(15,C,3,2,"div",9),e.j41(16,"div",10)(17,"label",11),e.EFF(18,"Nom d'utilisateur"),e.k0s(),e.j41(19,"input",12),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.username,t)||(s.username=t),i.Njj(t)}),e.k0s()(),e.j41(20,"div",10)(21,"label",13),e.EFF(22,"Nom"),e.k0s(),e.j41(23,"input",14),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.nom,t)||(s.nom=t),i.Njj(t)}),e.k0s()(),e.j41(24,"div",10)(25,"label",15),e.EFF(26,"Pr\xe9nom"),e.k0s(),e.j41(27,"input",16),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.prenom,t)||(s.prenom=t),i.Njj(t)}),e.k0s()(),e.j41(28,"div",10)(29,"label",17),e.EFF(30,"Adresse email *"),e.k0s(),e.j41(31,"input",18),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.email,t)||(s.email=t),i.Njj(t)}),e.k0s()(),e.j41(32,"div",19)(33,"label",20),e.EFF(34),e.DNE(35,M,2,0,"span",21),e.k0s(),e.j41(36,"input",22),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.password,t)||(s.password=t),i.Njj(t)}),e.k0s(),e.DNE(37,F,3,0,"small",23)(38,w,5,11,"div",24)(39,E,2,1,"ul",25),e.k0s(),e.j41(40,"div",10)(41,"label",26),e.EFF(42," Confirmer le mot de passe "),e.DNE(43,v,2,0,"span",21),e.k0s(),e.j41(44,"input",27),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.passwordConfirm,t)||(s.passwordConfirm=t),i.Njj(t)}),e.k0s(),e.DNE(45,I,4,3,"div",28)(46,U,3,0,"div",29),e.k0s(),e.j41(47,"div",10)(48,"label",30),e.EFF(49,"R\xf4le"),e.k0s(),e.j41(50,"select",31),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.role,t)||(s.role=t),i.Njj(t)}),e.j41(51,"option",32),e.EFF(52,"S\xe9lectionner un r\xf4le"),e.k0s(),e.DNE(53,T,2,2,"option",33),e.k0s()(),e.j41(54,"div",10)(55,"label",34),e.EFF(56,"T\xe9l\xe9phone"),e.k0s(),e.j41(57,"input",35),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.telephone,t)||(s.telephone=t),i.Njj(t)}),e.k0s()(),e.j41(58,"div",10)(59,"label",36),e.EFF(60,"Adresse"),e.k0s(),e.j41(61,"input",37),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.adresse,t)||(s.adresse=t),i.Njj(t)}),e.k0s()(),e.j41(62,"div",10)(63,"label",38),e.EFF(64,"Ville"),e.k0s(),e.j41(65,"input",39),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.ville,t)||(s.ville=t),i.Njj(t)}),e.k0s()(),e.j41(66,"div",10)(67,"label",40),e.EFF(68,"Code Postal"),e.k0s(),e.j41(69,"input",41),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.codePostal,t)||(s.codePostal=t),i.Njj(t)}),e.k0s()(),e.j41(70,"div",10)(71,"label",42),e.EFF(72,"Pays"),e.k0s(),e.j41(73,"input",43),e.mxI("ngModelChange",function(t){return i.eBV(a),e.DH7(s.pays,t)||(s.pays=t),i.Njj(t)}),e.k0s()(),e.j41(74,"button",44),e.bIt("click",function(){i.eBV(a);const t=e.sdS(10);return i.Njj(s.submit(t))}),e.EFF(75),e.k0s()()()()()()()}2&n&&(e.R7$(6),e.JRh(s.editMode?"Modifier un utilisateur":"Cr\xe9er un utilisateur"),e.R7$(8),e.JRh(s.editMode?"Modification":"Nouvel utilisateur"),e.R7$(),e.Y8G("ngIf",s.message),e.R7$(4),e.R50("ngModel",s.username),e.R7$(4),e.R50("ngModel",s.nom),e.R7$(4),e.R50("ngModel",s.prenom),e.R7$(4),e.R50("ngModel",s.email),e.R7$(3),e.SpI(" ",s.editMode?"Nouveau mot de passe":"Mot de passe"," "),e.R7$(),e.Y8G("ngIf",s.editMode),e.R7$(),e.Y8G("placeholder",s.editMode?"Laisser vide pour ne pas modifier":"Mot de passe"),e.R50("ngModel",s.password),e.Y8G("required",!s.editMode),e.R7$(),e.Y8G("ngIf",s.editMode&&!s.password),e.R7$(),e.Y8G("ngIf",s.password),e.R7$(),e.Y8G("ngIf",s.password),e.R7$(4),e.Y8G("ngIf",s.editMode&&!s.password),e.R7$(),e.Y8G("placeholder",s.editMode&&!s.password?"Non requis si pas de changement":"Confirmer le mot de passe"),e.R50("ngModel",s.passwordConfirm),e.Y8G("required",!s.editMode||s.editMode&&s.password),e.R7$(),e.Y8G("ngIf",s.password||!s.editMode),e.R7$(),e.Y8G("ngIf",s.editMode&&!s.password),e.R7$(4),e.R50("ngModel",s.role),e.R7$(3),e.Y8G("ngForOf",s.roles),e.R7$(4),e.R50("ngModel",s.telephone),e.R7$(4),e.R50("ngModel",s.adresse),e.R7$(4),e.R50("ngModel",s.ville),e.R7$(4),e.R50("ngModel",s.codePostal),e.R7$(4),e.R50("ngModel",s.pays),e.R7$(),e.Y8G("disabled",!s.canSubmit||s.loading),e.R7$(),e.SpI(" ",s.loading?s.editMode?"Modification...":"Cr\xe9ation...":s.editMode?"Modifier l'utilisateur":"Cr\xe9er l'utilisateur"," "))},dependencies:[c.iI,m.YN,m.qT,m.xH,m.y7,m.me,m.wz,m.BC,m.cb,m.YS,m.vS,m.cV,h.MD,h.YU,h.Sq,h.bT],styles:[".card[_ngcontent-%COMP%]{margin:2rem auto;max-width:800px}.card-header[_ngcontent-%COMP%]{background:#f8f9fa;border-bottom:1px solid #e9ecef}.card-body[_ngcontent-%COMP%]{padding:2rem}"]})}}return o})()}}]);