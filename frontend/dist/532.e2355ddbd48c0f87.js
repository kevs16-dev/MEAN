"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[532],{9532:(P,p,o)=>{o.d(p,{UsersListComponent:()=>x});var f=o(1413),F=o(3236),v=o(9974),_=o(4360),h=o(9769),r=o(4341),C=o(3794),E=o(3413),t=o(5547),c=o(375),j=o(7705),k=o(4666);const b=()=>[];function $(n,l){if(1&n&&(t.j41(0,"option",15),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.label)}}function U(n,l){if(1&n&&(t.j41(0,"option",16),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.Y8G("ngValue",e),t.R7$(),t.JRh(e)}}function T(n,l){1&n&&(t.j41(0,"div"),t.EFF(1,"Chargement..."),t.k0s())}function L(n,l){if(1&n&&(t.j41(0,"div",17),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.error)}}function G(n,l){if(1&n&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s()()),2&n){const e=l.$implicit,i=l.index,s=t.XpG(2);t.R7$(2),t.JRh((s.page-1)*s.limit+i+1),t.R7$(2),t.JRh(e.username),t.R7$(2),t.JRh(e.nom),t.R7$(2),t.JRh(e.prenom),t.R7$(2),t.JRh(e.email),t.R7$(2),t.JRh(e.role)}}function I(n,l){if(1&n&&(t.j41(0,"table",18)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"#"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Username"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Nom"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Pr\xe9nom"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Email"),t.k0s(),t.j41(13,"th"),t.EFF(14,"R\xf4le"),t.k0s()()(),t.j41(15,"tbody"),t.DNE(16,G,13,6,"tr",19),t.k0s()()),2&n){const e=t.XpG();t.R7$(16),t.Y8G("ngForOf",e.users)}}function Y(n,l){1&n&&(t.j41(0,"div"),t.EFF(1,"Aucun utilisateur trouv\xe9."),t.k0s())}function N(n,l){if(1&n){const e=t.RV6();t.j41(0,"li",22)(1,"button",23),t.bIt("click",function(){const s=c.eBV(e).index,a=t.XpG(2);return c.Njj(a.goToPage(s+1))}),t.EFF(2),t.k0s()()}if(2&n){const e=l.index,i=t.XpG(2);t.AVh("active",i.page===e+1),t.R7$(2),t.JRh(e+1)}}function V(n,l){if(1&n){const e=t.RV6();t.j41(0,"nav",20)(1,"ul",21)(2,"li",22)(3,"button",23),t.bIt("click",function(){c.eBV(e);const s=t.XpG();return c.Njj(s.goToPage(s.page-1))}),t.EFF(4,"Pr\xe9c\xe9dent"),t.k0s()(),t.DNE(5,N,3,3,"li",24),t.j41(6,"li",22)(7,"button",23),t.bIt("click",function(){c.eBV(e);const s=t.XpG();return c.Njj(s.goToPage(s.page+1))}),t.EFF(8,"Suivant"),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(2),t.AVh("disabled",1===e.page),t.R7$(3),t.Y8G("ngForOf",t.lJ4(5,b).constructor(e.totalPages)),t.R7$(),t.AVh("disabled",e.page===e.totalPages)}}let x=(()=>{class n{constructor(e,i){this.userService=e,this.cdr=i,this.users=[],this.loading=!1,this.error=null,this.page=1,this.limit=10,this.limits=[5,10,20],this.total=0,this.role="ALL",this.roles=[{label:"Tous",value:"ALL"},{label:"Admin",value:"ADMIN"},{label:"Boutique",value:"BOUTIQUE"},{label:"Client",value:"CLIENT"}],this.filterChanged$=new f.B,this.filterChanged$.pipe(function R(n,l=F.E){return(0,v.N)((e,i)=>{let s=null,a=null,u=null;const m=()=>{if(s){s.unsubscribe(),s=null;const g=a;a=null,i.next(g)}};function A(){const g=u+n,d=l.now();if(d<g)return s=this.schedule(void 0,g-d),void i.add(s);m()}e.subscribe((0,_._)(i,g=>{a=g,u=l.now(),s||(s=l.schedule(A,n),i.add(s))},()=>{m(),i.complete()},void 0,()=>{a=s=null}))})}(300)).subscribe(()=>{this.loadUsers()}),this.loadUsers()}loadUsers(){this.loading=!0,this.userService.getAllUsers({page:this.page,limit:this.limit,role:this.role}).subscribe({next:e=>{this.users=Array.isArray(e.users)?e.users:[],this.total="number"==typeof e.total?e.total:0,this.loading=!1,this.cdr.detectChanges()},error:e=>{this.error=e?.error?.message||"Erreur lors de la r\xe9cup\xe9ration des utilisateurs",this.users=[],this.total=0,this.loading=!1,this.cdr.detectChanges()}})}onRoleChange(e){this.role=e.target.value,this.page=1,this.filterChanged$.next()}goToPage(e){e<1||e>this.totalPages||(this.page=e,this.loadUsers())}onLimitChange(e){this.limits.includes(e)&&(this.limit=e,this.page=1,this.filterChanged$.next(),this.cdr.detectChanges())}get totalPages(){const s=Math.ceil((this.total||0)/(this.limit||1));return s>0?s:1}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(k.D),t.rXU(j.gRc))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-users-list"]],decls:19,vars:9,consts:[[1,"row"],[1,"col-sm-12"],["cardTitle","Utilisateurs"],[1,"mb-3","d-flex","align-items-center","gap-2"],["for","roleFilter",1,"form-label","mb-0"],["id","roleFilter",1,"form-select","w-auto",3,"change","value"],[3,"value",4,"ngFor","ngForOf"],["for","limitSelect",1,"form-label","mb-0","ms-3"],["id","limitSelect",1,"form-select","w-auto",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"ms-1"],[4,"ngIf"],["class","text-danger",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"value"],[3,"ngValue"],[1,"text-danger"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"mt-3"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"div",3)(4,"label",4),t.EFF(5,"Filtrer par r\xf4le :"),t.k0s(),t.j41(6,"select",5),t.bIt("change",function(u){return s.onRoleChange(u)}),t.DNE(7,$,2,2,"option",6),t.k0s(),t.j41(8,"label",7),t.EFF(9,"Afficher :"),t.k0s(),t.j41(10,"select",8),t.bIt("ngModelChange",function(u){return s.onLimitChange(u)}),t.DNE(11,U,2,2,"option",9),t.k0s(),t.j41(12,"span",10),t.EFF(13,"par page"),t.k0s()(),t.DNE(14,T,2,0,"div",11)(15,L,2,1,"div",12)(16,I,17,1,"table",13)(17,Y,2,0,"div",11)(18,V,9,6,"nav",14),t.k0s()()()),2&i&&(t.R7$(6),t.Y8G("value",s.role),t.R7$(),t.Y8G("ngForOf",s.roles),t.R7$(3),t.Y8G("ngModel",s.limit),t.R7$(),t.Y8G("ngForOf",s.limits),t.R7$(3),t.Y8G("ngIf",s.loading),t.R7$(),t.Y8G("ngIf",s.error),t.R7$(),t.Y8G("ngIf",!s.loading&&s.users.length),t.R7$(),t.Y8G("ngIf",!s.loading&&!s.users.length),t.R7$(),t.Y8G("ngIf",!s.loading&&s.totalPages>1))},dependencies:[h.MD,h.Sq,h.bT,C.q1,E.i,r.YN,r.xH,r.y7,r.wz,r.BC,r.vS],styles:[".table[_ngcontent-%COMP%]{margin-top:1rem}"]})}}return n})()}}]);