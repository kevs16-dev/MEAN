"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[941],{6941:(M,m,d)=>{d.d(m,{GestionProfilComponent:()=>w});var c=d(9769),p=d(4341),g=d(3413),n=d(375),e=d(5547),f=d(7705),_=d(4666);function h(i,u){if(1&i&&(e.j41(0,"div",50),e.nrm(1,"i",51),e.EFF(2),e.k0s()),2&i){const s=e.XpG();e.Y8G("ngClass",s.alertType),e.R7$(2),e.SpI(" ",s.message," ")}}function b(i,u){1&i&&(e.j41(0,"div",61),e.EFF(1," Les mots de passe ne correspondent pas "),e.k0s())}function P(i,u){if(1&i){const s=e.RV6();e.j41(0,"form",null,1)(2,"div",32)(3,"label",52),e.EFF(4,"Mot de passe actuel"),e.k0s(),e.j41(5,"input",53),e.mxI("ngModelChange",function(o){n.eBV(s);const a=e.XpG();return e.DH7(a.passwordData.currentPassword,o)||(a.passwordData.currentPassword=o),n.Njj(o)}),e.k0s()(),e.j41(6,"div",32)(7,"label",54),e.EFF(8,"Nouveau mot de passe"),e.k0s(),e.j41(9,"input",55),e.mxI("ngModelChange",function(o){n.eBV(s);const a=e.XpG();return e.DH7(a.passwordData.newPassword,o)||(a.passwordData.newPassword=o),n.Njj(o)}),e.k0s()(),e.j41(10,"div",56)(11,"label",57),e.EFF(12,"Confirmer le mot de passe"),e.k0s(),e.j41(13,"input",58),e.mxI("ngModelChange",function(o){n.eBV(s);const a=e.XpG();return e.DH7(a.passwordData.confirmPassword,o)||(a.passwordData.confirmPassword=o),n.Njj(o)}),e.k0s(),e.DNE(14,b,2,0,"div",59),e.k0s(),e.j41(15,"div",42)(16,"button",43),e.bIt("click",function(){n.eBV(s);const o=e.XpG();return n.Njj(o.submitPassword())}),e.nrm(17,"i",60),e.EFF(18),e.k0s()()()}if(2&i){const s=e.sdS(1),r=e.XpG();e.R7$(5),e.R50("ngModel",r.passwordData.currentPassword),e.R7$(4),e.R50("ngModel",r.passwordData.newPassword),e.R7$(4),e.R50("ngModel",r.passwordData.confirmPassword),e.R7$(),e.Y8G("ngIf",r.passwordData.newPassword&&r.passwordData.confirmPassword&&r.passwordData.newPassword!==r.passwordData.confirmPassword),e.R7$(2),e.Y8G("disabled",r.loading||s.invalid||!r.canSubmitPassword),e.R7$(2),e.SpI(" ",r.loading?"Modification...":"Modifier le mot de passe"," ")}}let w=(()=>{class i{constructor(s,r){this.cdr=s,this.userService=r,this.utilisateur={},this.loading=!1,this.message="",this.alertType="alert-success",this.passwordData={currentPassword:"",newPassword:"",confirmPassword:""},this.showPasswordSection=!1}get canSubmitProfile(){return!!this.utilisateur.nom&&!!this.utilisateur.prenom&&!!this.utilisateur.email}get canSubmitPassword(){return!!this.passwordData.currentPassword&&!!this.passwordData.newPassword&&!!this.passwordData.confirmPassword&&this.passwordData.newPassword===this.passwordData.confirmPassword}submitProfile(){this.canSubmitProfile&&!this.loading&&(this.loading=!0,this.message="",this.userService.updateProfile({id:this.utilisateur._id,nom:this.utilisateur.nom,prenom:this.utilisateur.prenom,email:this.utilisateur.email,telephone:this.utilisateur.telephone,adresse:this.utilisateur.adresse,ville:this.utilisateur.ville,codePostal:this.utilisateur.codePostal,pays:this.utilisateur.pays,avatar:this.utilisateur.avatar}).subscribe({next:r=>{this.message="Profil mis \xe0 jour avec succ\xe8s",this.alertType="alert-success",this.loading=!1,this.utilisateur=r.user,this.cdr.detectChanges()},error:r=>{this.message=r.error.message||"Erreur lors de la mise \xe0 jour du profil",this.alertType="alert-error",this.loading=!1,this.cdr.detectChanges()}}))}submitPassword(){!this.canSubmitPassword||this.loading||(this.loading=!0,this.message="",this.userService.updatePassword({currentPassword:this.passwordData.currentPassword,newPassword:this.passwordData.newPassword}).subscribe({next:()=>{this.message="Mot de passe modifi\xe9 avec succ\xe8s",this.alertType="alert-success",this.loading=!1,this.passwordData={currentPassword:"",newPassword:"",confirmPassword:""},this.showPasswordSection=!1,this.cdr.detectChanges()},error:s=>{const r=s?.error?.code;this.message="INVALID_CURRENT_PASSWORD"===r?"Mot de passe actuel incorrect":s.message||"Erreur lors de la mise \xe0 jour du mot de passe1",this.alertType="alert-error",this.loading=!1,this.cdr.detectChanges()}}))}togglePasswordSection(){this.showPasswordSection=!this.showPasswordSection,this.showPasswordSection||(this.passwordData={currentPassword:"",newPassword:"",confirmPassword:""})}onFileSelected(s){const r=s.target;if(r.files&&r.files[0]){const o=r.files[0],a=new FileReader;a.onload=l=>{this.utilisateur.avatar=l.target.result,this.cdr.detectChanges()},a.readAsDataURL(o)}}ngOnInit(){this.utilisateur=this.userService.getUtilisateur()}static{this.\u0275fac=function(r){return new(r||i)(e.rXU(f.gRc),e.rXU(_.D))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-gestion-profil"]],decls:103,vars:36,consts:[["profileForm","ngForm"],["passwordForm","ngForm"],[1,"row"],[1,"col-xl-4","col-lg-5"],["cardTitle","Photo de profil","cardClass","mb-4"],[1,"text-center"],[1,"profile-avatar-wrapper","mb-3"],["alt","Avatar",1,"profile-avatar",3,"src"],["for","avatar-upload",1,"avatar-upload-btn"],[1,"ti","ti-camera"],["type","file","id","avatar-upload","accept","image/*",1,"d-none",3,"change"],[1,"mb-1"],[1,"text-muted","mb-0"],["cardTitle","Informations du compte"],[1,"account-info"],[1,"info-item","mb-3"],[1,"text-muted","small"],[1,"mb-0","fw-semibold"],[1,"info-item"],[1,"col-xl-8","col-lg-7"],["cardTitle","Modifier le profil","cardClass","mb-4"],["class","custom-alert mb-4",3,"ngClass",4,"ngIf"],[1,"col-md-6","mb-3"],["for","nom",1,"form-label"],[1,"text-danger"],["type","text","id","nom","placeholder","Nom","name","nom","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","prenom",1,"form-label"],["type","text","id","prenom","placeholder","Pr\xe9nom","name","prenom","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","placeholder","email@example.com","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","telephone",1,"form-label"],["type","tel","id","telephone","placeholder","+33 6 12 34 56 78","name","telephone",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["for","adresse",1,"form-label"],["type","text","id","adresse","placeholder","Adresse","name","adresse",1,"form-control",3,"ngModelChange","ngModel"],["for","ville",1,"form-label"],["type","text","id","ville","placeholder","Ville","name","ville",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3","mb-3"],["for","codePostal",1,"form-label"],["type","text","id","codePostal","placeholder","75001","name","codePostal",1,"form-control",3,"ngModelChange","ngModel"],["for","pays",1,"form-label"],["type","text","id","pays","placeholder","France","name","pays",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"ti","ti-device-floppy","me-2"],["cardTitle","Changer le mot de passe"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"ti",3,"ngClass"],[4,"ngIf"],[1,"custom-alert","mb-4",3,"ngClass"],[1,"ti","ti-info-circle","me-2"],["for","currentPassword",1,"form-label"],["type","password","id","currentPassword","placeholder","Mot de passe actuel","name","currentPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","placeholder","Nouveau mot de passe","name","newPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","placeholder","Confirmer le mot de passe","name","confirmPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],["class","text-danger small mt-1",4,"ngIf"],[1,"ti","ti-key","me-2"],[1,"text-danger","small","mt-1"]],template:function(r,o){if(1&r){const a=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"app-card",4)(3,"div",5)(4,"div",6),e.nrm(5,"img",7),e.j41(6,"label",8),e.nrm(7,"i",9),e.k0s(),e.j41(8,"input",10),e.bIt("change",function(t){return n.eBV(a),n.Njj(o.onFileSelected(t))}),e.k0s()(),e.j41(9,"h5",11),e.EFF(10),e.k0s(),e.j41(11,"p",12),e.EFF(12),e.k0s()()(),e.j41(13,"app-card",13)(14,"div",14)(15,"div",15)(16,"label",16),e.EFF(17,"Nom d'utilisateur"),e.k0s(),e.j41(18,"p",17),e.EFF(19),e.k0s()(),e.j41(20,"div",15)(21,"label",16),e.EFF(22,"Email"),e.k0s(),e.j41(23,"p",17),e.EFF(24),e.k0s()(),e.j41(25,"div",15)(26,"label",16),e.EFF(27,"T\xe9l\xe9phone"),e.k0s(),e.j41(28,"p",17),e.EFF(29),e.k0s()(),e.j41(30,"div",15)(31,"label",16),e.EFF(32,"Membre depuis"),e.k0s(),e.j41(33,"p",17),e.EFF(34),e.nI1(35,"date"),e.k0s()(),e.j41(36,"div",18)(37,"label",16),e.EFF(38,"R\xf4le"),e.k0s(),e.j41(39,"p",17),e.EFF(40),e.nI1(41,"lowercase"),e.nI1(42,"slice"),e.nI1(43,"lowercase"),e.nI1(44,"slice"),e.k0s()()()()(),e.j41(45,"div",19)(46,"app-card",20),e.DNE(47,h,3,2,"div",21),e.j41(48,"form",null,0)(50,"div",2)(51,"div",22)(52,"label",23),e.EFF(53,"Nom "),e.j41(54,"span",24),e.EFF(55,"*"),e.k0s()(),e.j41(56,"input",25),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.nom,t)||(o.utilisateur.nom=t),n.Njj(t)}),e.k0s()(),e.j41(57,"div",22)(58,"label",26),e.EFF(59,"Pr\xe9nom "),e.j41(60,"span",24),e.EFF(61,"*"),e.k0s()(),e.j41(62,"input",27),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.prenom,t)||(o.utilisateur.prenom=t),n.Njj(t)}),e.k0s()()(),e.j41(63,"div",2)(64,"div",22)(65,"label",28),e.EFF(66,"Email "),e.j41(67,"span",24),e.EFF(68,"*"),e.k0s()(),e.j41(69,"input",29),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.email,t)||(o.utilisateur.email=t),n.Njj(t)}),e.k0s()(),e.j41(70,"div",22)(71,"label",30),e.EFF(72,"T\xe9l\xe9phone"),e.k0s(),e.j41(73,"input",31),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.telephone,t)||(o.utilisateur.telephone=t),n.Njj(t)}),e.k0s()()(),e.j41(74,"div",32)(75,"label",33),e.EFF(76,"Adresse"),e.k0s(),e.j41(77,"input",34),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.adresse,t)||(o.utilisateur.adresse=t),n.Njj(t)}),e.k0s()(),e.j41(78,"div",2)(79,"div",22)(80,"label",35),e.EFF(81,"Ville"),e.k0s(),e.j41(82,"input",36),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.ville,t)||(o.utilisateur.ville=t),n.Njj(t)}),e.k0s()(),e.j41(83,"div",37)(84,"label",38),e.EFF(85,"Code postal"),e.k0s(),e.j41(86,"input",39),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.codePostal,t)||(o.utilisateur.codePostal=t),n.Njj(t)}),e.k0s()(),e.j41(87,"div",37)(88,"label",40),e.EFF(89,"Pays"),e.k0s(),e.j41(90,"input",41),e.mxI("ngModelChange",function(t){return n.eBV(a),e.DH7(o.utilisateur.pays,t)||(o.utilisateur.pays=t),n.Njj(t)}),e.k0s()()(),e.j41(91,"div",42)(92,"button",43),e.bIt("click",function(){return n.eBV(a),n.Njj(o.submitProfile())}),e.nrm(93,"i",44),e.EFF(94),e.k0s()()()(),e.j41(95,"app-card",45)(96,"div",46)(97,"p",12),e.EFF(98,"Mettez \xe0 jour votre mot de passe pour s\xe9curiser votre compte."),e.k0s(),e.j41(99,"button",47),e.bIt("click",function(){return n.eBV(a),n.Njj(o.togglePasswordSection())}),e.nrm(100,"i",48),e.EFF(101),e.k0s()(),e.DNE(102,P,19,6,"form",49),e.k0s()()()}if(2&r){const a=e.sdS(49);e.R7$(5),e.Y8G("src","assets/images/user/avatar-1.jpg",e.B4B),e.R7$(5),e.JRh(o.utilisateur.username),e.R7$(2),e.JRh(o.utilisateur.email),e.R7$(7),e.JRh(o.utilisateur.username),e.R7$(5),e.JRh(o.utilisateur.email),e.R7$(5),e.JRh(o.utilisateur.telephone||"Non renseign\xe9"),e.R7$(5),e.JRh(e.i5U(35,22,o.utilisateur.createdAt,"dd/MM/yyyy")),e.R7$(6),e.SpI(" ",o.utilisateur.role?e.brH(42,27,e.bMT(41,25,o.utilisateur.role),0,1).toUpperCase()+e.i5U(44,33,e.bMT(43,31,o.utilisateur.role),1):""," "),e.R7$(7),e.Y8G("ngIf",o.message),e.R7$(9),e.R50("ngModel",o.utilisateur.nom),e.R7$(6),e.R50("ngModel",o.utilisateur.prenom),e.R7$(7),e.R50("ngModel",o.utilisateur.email),e.R7$(4),e.R50("ngModel",o.utilisateur.telephone),e.R7$(4),e.R50("ngModel",o.utilisateur.adresse),e.R7$(5),e.R50("ngModel",o.utilisateur.ville),e.R7$(4),e.R50("ngModel",o.utilisateur.codePostal),e.R7$(4),e.R50("ngModel",o.utilisateur.pays),e.R7$(2),e.Y8G("disabled",o.loading||a.invalid||!o.canSubmitProfile),e.R7$(2),e.SpI(" ",o.loading?"Enregistrement...":"Enregistrer les modifications"," "),e.R7$(6),e.Y8G("ngClass",o.showPasswordSection?"ti-eye-off":"ti-edit"),e.R7$(),e.SpI(" ",o.showPasswordSection?"Annuler":"Modifier"," "),e.R7$(),e.Y8G("ngIf",o.showPasswordSection)}},dependencies:[c.MD,c.YU,c.bT,p.YN,p.qT,p.me,p.BC,p.cb,p.YS,p.vS,p.cV,g.i,c.GH,c.P9,c.vh],styles:[".profile-avatar-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.profile-avatar-wrapper[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;object-fit:cover;border:4px solid var(--bs-border-color);box-shadow:0 4px 12px #0000001a}.profile-avatar-wrapper[_ngcontent-%COMP%]   .avatar-upload-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:36px;height:36px;border-radius:50%;background:var(--bs-primary);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;border:3px solid #ffffff;box-shadow:0 2px 8px #00000026;transition:all .3s ease}.profile-avatar-wrapper[_ngcontent-%COMP%]   .avatar-upload-btn[_ngcontent-%COMP%]:hover{background:var(--bs-primary-dark);transform:scale(1.1)}.profile-avatar-wrapper[_ngcontent-%COMP%]   .avatar-upload-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.account-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{padding-bottom:16px;border-bottom:1px solid var(--bs-border-color)}.account-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]:last-child{border-bottom:none;padding-bottom:0}.account-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:4px;font-size:.875rem;text-transform:uppercase;letter-spacing:.5px}.account-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:var(--bs-body-color)}.custom-alert[_ngcontent-%COMP%]{border-radius:12px;padding:14px 16px;font-size:.9rem;font-weight:500;display:flex;align-items:center;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}.custom-alert[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.alert-success[_ngcontent-%COMP%]{background:#1987541a;color:#198754;border:1px solid rgba(25,135,84,.2)}.alert-error[_ngcontent-%COMP%]{background:#dc35451a;color:#dc3545;border:1px solid rgba(220,53,69,.2)}.alert-warning[_ngcontent-%COMP%]{background:#ffc1071a;color:#ffc107;border:1px solid rgba(255,193,7,.2)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:8px;color:var(--bs-body-color)}.form-label[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{margin-left:2px}.form-control[_ngcontent-%COMP%]{border-radius:8px;border:1px solid var(--bs-border-color);padding:10px 14px;transition:all .3s ease}.form-control[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .2rem rgba(var(--bs-primary-rgb),.1)}.form-control[_ngcontent-%COMP%]::placeholder{color:var(--bs-secondary);opacity:.6}.btn[_ngcontent-%COMP%]{border-radius:8px;padding:10px 20px;font-weight:500;transition:all .3s ease}.btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--bs-primary);border-color:var(--bs-primary)}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--bs-primary-dark);border-color:var(--bs-primary-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(var(--bs-primary-rgb),.3)}.btn-outline-primary[_ngcontent-%COMP%]{border-color:var(--bs-primary);color:var(--bs-primary)}.btn-outline-primary[_ngcontent-%COMP%]:hover{background:var(--bs-primary);border-color:var(--bs-primary);color:#fff}@media(max-width:768px){.profile-avatar-wrapper[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:100px;height:100px}.profile-avatar-wrapper[_ngcontent-%COMP%]   .avatar-upload-btn[_ngcontent-%COMP%]{width:32px;height:32px}.profile-avatar-wrapper[_ngcontent-%COMP%]   .avatar-upload-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}"]})}}return i})()}}]);